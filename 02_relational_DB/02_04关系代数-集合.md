# 集合运算与关系代数

在之前,我们明确过一个重要概念**关系代数是建立在严格的集合操作和逻辑操作上的**

* 域: 列所有可能取值的**集合**
* 表: 实体的**集合**

### 关系代数特点 
1. 关系代数的运算对象是关系结果也是关系
2. 关系代数是以集合为基础的运算
3. 列同质: 同一列中的分量都来自于同一个域
4. 不同的列中元素可以来自同一个域
5. 列无序: 列的位置可以互换,不影响整体关系,关系以内容来区分,不以位置区分
6. 行无序: 同上



## 关系的表示
我们使用集合的方式表达一个关系.

$$
Relationship : R(A_1:D_1,A_2:D_2,...,A_n:D_n)
$$

$$ R $$   :关系名  

$$ n $$   :关系的度/目(degree),表示`关系的列数`或`实体(元组)的分量个数`

$$ A_i ,i \in \{1,2,...,n\}$$ :第i个属性

$$ D_i$$ :属性$$A_i$$的域

$$A_i:D_i$$ 表示属性$$A_i$$的属性值$$a_i$$ 取值范围在$$a_i \in D_i$$

可以缺省属性的域, 简写为

$$
Relationship : R(A_1,A_2,...,A_n)
$$

我们可以用集合的方式指定有穷域. 我们有一个`家庭`关系： 
```
家庭(父亲:男域,母亲:女域,子女:孩子域)
其中:
男域   = {"张三","李四"}
女域   = {"小花","小梅"}
孩子域 = {"张小三","李小四","李四花"}
```

也可使用属性的数据类型/长度来构造域(在S_sex字段使用枚举类型实际就是有穷的规定域)
```sql
Student(S_num int, S_name char(20),S_sex enum('male','famale'),S_age int,S_class int(8))
```


# 关系代数分类
所以我们将关系代数分为两个大类:
1. 集合操作[根本]: 关系的本质是集合,所以可以沿用所有数学上的集合运算,集合运算输入输出均为集合. 另一方面,元组作为集合的基本组成元素, 集合运算中也支持元组演算.
2. 关系操作[特有]: 在集合运算的基础上,拓展了关系运算.

## 集合操作

集合操作延续数学中的集合操作
有元组 `s` `r` , 关系 `S` `R` , 操作结果为`T`

 $$s \in S  \quad , \quad r \in R$$


 |   操作   |       name        |     集合表达      |                       元组表达                        |
 | :------: | :---------------: | :---------------: | :---------------------------------------------------: |
 |    并    |       union       | $$ T= R \cup S $$ |         $$\{t \mid t \in R \lor t \in S \}$$          |
 |    交    |   intersection    | $$ T= R \cap S $$ |         $$\{t \mid t \in R \land t \in S \}$$         |
 |    差    |    difference     |   $$ T=  R-S $$   |       $$\{t \mid t \in R \land t \notin S \}$$        |
 | 笛卡尔积 | cartesian product |  $$ T=  R \times S $$|$$  \{ <a_1 ,a_2,..., a_n, b_1, b_2,..., b_m> \mid  <a_1 ,a_2, …, a_n > \in R \land <b1, b2, …, bm> \in S \}$$ |


#### 并相容性
关系代数基于集合运算, 在关系代数中,待操作关系应当满足并相容性:参与运算的两个关系及其相关属性之间有一定的对应性、可比性或意义关联性

* 关系R和关系S的属性数目必须相同
* 对于任意i，关系R的第i个属性的域必须和关系S的第i个属性的域相同

define：有两个关系R S$$R(A_1, A_2, … , A_n)，S(B_1, B_2, … ,B_m)$$ ，R和S满足并相容性当且仅当：$$ n = m \land Domain(Ai) = Domain(Bi)$$


## 关系操作


 | 操作  |  name   |         集合表达         |                                            元组表达                                             |
 | :---: | :-----: | :----------------------: | :---------------------------------------------------------------------------------------------: |
 | 选择  | select  | $$ T= \sigma_{cop}(R) $$ |                 $$ \sigma_{con}(R) = \{ t \mid  t \in R \land con(t)=true \}$$                  |
 | 投影  | project |      $$ T= \pi_S $$      | $$ \pi_{A_{i1},A_{i2},...,A_{ik}}(R) = \{ <t[A_{i1}],t[A_{ik}],...,t[A_{in}]> \mid t \in R \}$$ |
 | 连接  |  join   |   $$ T=  R \Join S $$    |          $$ R \underset{R \Theta S}{\Join} S = \pi_{t[A]\Theta{s[B]}}(R \times S ) $$  |